<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<head>
    <title>Weather</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossOrigin="anonymous"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" type="text/css">
    <style>
        #map {
            width: 100%;
            height: 700px;
        }
        #menu {
            position: absolute;
            background: #865fb4;
            padding: 10px;
            font-family: 'Open Sans', sans-serif;
            width: 100%;
            height: 5em;
        }
        label {
            padding-right: 1em;
            color: white
        }
        .flex-container{
            background-color: #865fb4;
        }
        h1 {
            color: white;
            text-shadow: 2px 2px rgba(211, 211, 211, 0.5);
        }
        /*.card-img-top {*/
        /*    height: 10px;*/
        /*    width: 10px;*/
        /*}*/
    </style>
</head>
<body>
<div class="flex-container">
    <header class="d-flex flex-wrap justify-content-center py-3">
        <a href="" class="d-flex align-items-center pt-1 mt-2 mb-0 text-dark text-decoration-none">
            <h1>Weather App</h1>
        </a>
    </header>
</div>

<!-- The HTML element that serves as the Mapbox container -->
<div id='map'></div>
<div id="menu">
    <input id="streets-v11" type="radio" name="rtoggle" value="streets" checked="checked">
    <label for="streets-v11">streets</label>
    <input id="satellite-v9" type="radio" name="rtoggle" value="satellite">
    <label for="satellite-v9">satellite</label>
    <input id="light-v10" type="radio" name="rtoggle" value="light">
    <label for="light-v10">light</label>
    <input id="dark-v10" type="radio" name="rtoggle" value="dark">
    <label for="dark-v10">dark</label>
    <input id="outdoors-v11" type="radio" name="rtoggle" value="outdoors">
    <label for="outdoors-v11">outdoors</label>
</div>






<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossOrigin="anonymous"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src="js/keys.js"></script>
<script>



    mapboxgl.accessToken = myMapBoxToken;
    let map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        zoom: 4,
        center: [-98.4916, 29.4252],
        pitch: 45
    });
    const nav = new mapboxgl.NavigationControl({
        visualizePitch: true,
        showCompass: true
    });
    map.addControl(nav, 'bottom-right');
    let geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl
    });
    map.addControl(geocoder, 'top-left');
    const geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
            enableHighAccuracy: true
        },
        trackUserLocation: true
    });

    map.addControl(geolocate);
    // geolocate.on('trackuserlocationstart', (e) => {
    //     marker = new mapboxgl
    //         .Marker({ draggable: true, color: "purple" })
    //         .setLngLat(e)
    //         .addTo(map)
    //         .setPopup(popup);
    //     marker.on('dragend', getWeather)
    //     getWeather()
    // });

    // change map type functionality
    const layerList = document.getElementById('menu');
    const inputs = layerList.getElementsByTagName('input');
    for (const input of inputs) {
        input.onclick = (layer) => {
            const layerId = layer.target.id;
            map.setStyle('mapbox://styles/mapbox/' + layerId);
        };
    }
    let popup = new mapboxgl.Popup().addTo(map);


    geocoder.on('result', function(e) {
        geocoder.clear()
        marker = new mapboxgl
            .Marker({ draggable: true, color: "purple" })
            .setLngLat(e.result.center)
            .addTo(map)
            .setPopup(popup);
        marker.on('dragend', getWeather)
        getWeather()
    });



function getWeather() {
    $.get("https://api.openweathermap.org/data/2.5/onecall?", {
        APPID: myWeatherToken,
        lat: marker.getLngLat().lat,
        lon: marker.getLngLat().lng,
        units: "imperial"
    }).done(function (data) {
        console.log(data)
        let {icon} = data.current.weather[0];
        let popupCard = `<div className="card" style="width: 10rem;">
                    <div className="card-body">
                        <h6 className="card-title">Today's Forecast</h6>
                        <img className="card-img-top" src="http://openweathermap.org/img/w/${icon}.png" alt="Current Condition" style="width: 17.5rem">
                        <p>Current Temperature: ${Math.round(data.current.temp)} ˚ <br>Feels Like: ${Math.round(data.current.feels_like)} ˚<br> Humidity: ${data.current.humidity}%</p>

                        <a href="" className="btn btn-primary">See full forecast</a>
                    </div>
            </div>`
        popup.setHTML(popupCard)
    })
}









</script>


</body>



